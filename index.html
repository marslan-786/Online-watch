<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Watch Party - Silent Cinema</title>
    
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <style>
        /* Dark Theme / Elite Look */
        body {
            background-color: #121212;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
        }

        /* Lobby Screen (Create Link) */
        #lobby-screen {
            text-align: center;
            background: #1e1e1e;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
            width: 90%;
            max-width: 500px;
        }

        input {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border: 1px solid #333;
            background: #2c2c2c;
            color: white;
            font-size: 16px;
            outline: none;
        }

        input:focus {
            border-color: #00ff88;
        }

        .btn {
            background: #00ff88;
            color: #121212;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            width: 100%;
        }

        .btn:hover {
            background: #00cc6a;
            transform: scale(1.02);
        }

        /* Player Screen (Hidden by default) */
        #player-screen {
            display: none; /* Ø´Ø±ÙˆØ¹Ø§Øª Ù…ÛŒÚº Ú†Ú¾Ù¾Ø§ ÛÙˆØ§ */
            width: 90%;
            max-width: 1000px;
        }

        .controls-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            background: #1e1e1e;
            padding: 10px 20px;
            border-radius: 10px;
        }

        .mic-btn {
            background: #ff4b4b; /* Red implies Muted initially or Stop */
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px rgba(255, 75, 75, 0.5);
        }

        .mic-btn.active {
            background: #00ff88; /* Green implies Active */
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.6);
        }

        .status-text {
            color: #aaa;
            font-size: 14px;
        }

        #share-link-display {
            margin-top: 10px;
            background: #222;
            padding: 10px;
            border: 1px dashed #555;
            color: #00ff88;
            font-family: monospace;
            word-break: break-all;
            display: none;
        }
    </style>
</head>
<body>

    <div id="lobby-screen">
        <h2>ğŸ¬ Watch Party Creator</h2>
        <p style="color:#aaa;">Paste YouTube or Direct Video Link</p>
        
        <input type="text" id="video-url" placeholder="https://youtube.com/... or .mp4 link">
        <button class="btn" onclick="generateLink()">Generate Room Link</button>
    </div>

    <div id="player-screen">
        <video id="player" playsinline controls>
            </video>

        <div class="controls-bar">
            <div>
                <button class="mic-btn" id="mic-toggle" onclick="toggleMic()">
                    <i class="fas fa-microphone-slash"></i>
                </button>
                <span style="margin-left:10px; font-size:12px;">Voice Chat</span>
            </div>
            
            <div style="text-align: right;">
                <div class="status-text" id="user-status">You are the Admin</div>
                <button onclick="copyLink()" style="background:none; border:none; color:#00ff88; cursor:pointer; margin-top:5px;">
                    <i class="fas fa-link"></i> Copy Link
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <script>
        // Plyr Player Ú©Ùˆ initialize Ú©Ø±Ù†Ø§
        let player;

        // URL Ø³Û’ Parameters Ù†Ú©Ø§Ù„Ù†Ø§ (Ú†ÛŒÚ© Ú©Ø±Ù†Ø§ Ú©Û Ú©ÛŒØ§ ÛŒÙˆØ²Ø± Ù„Ù†Ú© Ø¬ÙˆØ§Ø¦Ù† Ú©Ø± Ú©Û’ Ø¢ÛŒØ§ ÛÛ’ØŸ)
        const urlParams = new URLSearchParams(window.location.search);
        const roomId = urlParams.get('room');
        const videoSrc = urlParams.get('v');
        const sourceType = urlParams.get('type'); // youtube or direct

        // === Ù„Ø§Ø¬Ú© Ø´Ø±ÙˆØ¹ ===
        
        if (roomId && videoSrc) {
            // Ø§Ú¯Ø± URL Ù…ÛŒÚº Room ID ÛÛ’ØŒ ØªÙˆ ÚˆØ§Ø¦Ø±ÛŒÚ©Ù¹ Ù¾Ù„ÛŒØ¦Ø± Ø¯Ú©Ú¾Ø§Ø¦ÛŒÚº
            enterRoom(videoSrc, sourceType);
        }

        // 1. Ù„Ù†Ú© Ø¬Ù†Ø±ÛŒÙ¹ Ú©Ø±Ù†Û’ Ú©Ø§ ÙÙ†Ú©Ø´Ù†
        function generateLink() {
            const inputUrl = document.getElementById('video-url').value;
            
            if (!inputUrl) return alert("Please enter a link!");

            // ÛŒÙˆÙ¹ÛŒÙˆØ¨ ÛŒØ§ ÚˆØ§Ø¦Ø±ÛŒÚ©Ù¹ Ú©Ø§ ÙÛŒØµÙ„Û (Simple Check)
            let type = 'direct';
            if (inputUrl.includes('youtube.com') || inputUrl.includes('youtu.be')) {
                type = 'youtube';
            }

            // Ø§ÛŒÚ© ÙØ±Ø¶ÛŒ Room ID Ø¨Ù†Ø§Ù†Ø§
            const randomRoom = Math.random().toString(36).substring(7);

            // Ù†ÛŒØ§ Ù„Ù†Ú© Ø¨Ù†Ø§Ù†Ø§
            const currentUrl = window.location.href.split('?')[0];
            const finalLink = `${currentUrl}?room=${randomRoom}&type=${type}&v=${encodeURIComponent(inputUrl)}`;

            // Ù¾ÛŒØ¬ Ú©Ùˆ Ø±ÛŒ Ù„ÙˆÚˆ Ú©ÛŒÛ’ Ø¨ØºÛŒØ± URL ØªØ¨Ø¯ÛŒÙ„ Ú©Ø±Ù†Ø§ Ø§ÙˆØ± Ø±ÙˆÙ… Ù…ÛŒÚº Ù„Û’ Ø¬Ø§Ù†Ø§
            window.history.pushState({}, '', finalLink);
            enterRoom(inputUrl, type);
        }

        // 2. Ø±ÙˆÙ… Ù…ÛŒÚº Ø¯Ø§Ø®Ù„ ÛÙˆÙ†Û’ Ú©Ø§ ÙÙ†Ú©Ø´Ù†
        function enterRoom(url, type) {
            // Lobby Ú†Ú¾Ù¾Ø§Ø¤ØŒ Player Ø¯Ú©Ú¾Ø§Ø¤
            document.getElementById('lobby-screen').style.display = 'none';
            document.getElementById('player-screen').style.display = 'block';

            // Ù¾Ù„ÛŒØ¦Ø± Ø³ÛŒÙ¹ Ø§Ù¾ Ú©Ø±ÛŒÚº
            let sourceConfig = {};

            if (type === 'youtube') {
                sourceConfig = {
                    type: 'video',
                    sources: [{ src: url, provider: 'youtube' }]
                };
            } else {
                sourceConfig = {
                    type: 'video',
                    sources: [{ src: url, type: 'video/mp4' }]
                };
            }

            // Plyr Ú©Ùˆ ÙˆÛŒÚˆÛŒÙˆ Ø¯ÛŒÚº
            player = new Plyr('#player', {
                controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'fullscreen'],
            });

            player.source = sourceConfig;

            // ÛŒÛÛŒÚº Ù¾Ø± Socket.io Ú©Ø§ Ú©ÙˆÚˆ Ø¢Ø¦Û’ Ú¯Ø§ Ø¬Ùˆ ÙˆÛŒÚˆÛŒÙˆ Ú©Ùˆ Ø³Ù†Ú© Ú©Ø±Û’ Ú¯Ø§
            console.log("Joined Room:", roomId);
            console.log("Playing:", url);
        }

        // 3. Ù…Ø§Ø¦ÛŒÚ© Ø¨Ù¹Ù† Ú©Ø§ ÙÙ†Ú©Ø´Ù† (ØµØ±Ù UI Ù„Ø§Ø¬Ú©)
        let isMicOn = false;
        function toggleMic() {
            const btn = document.getElementById('mic-toggle');
            const icon = btn.querySelector('i');

            isMicOn = !isMicOn;

            if (isMicOn) {
                btn.classList.add('active');
                icon.classList.remove('fa-microphone-slash');
                icon.classList.add('fa-microphone');
                // ÛŒÛØ§Úº WebRTC logic Ø¢Ø¦Û’ Ú¯ÛŒ Ù…Ø§Ø¦ÛŒÚ© Ø¢Ù† Ú©Ø±Ù†Û’ Ú©ÛŒ
                console.log("Mic Unmuted");
            } else {
                btn.classList.remove('active');
                icon.classList.remove('fa-microphone');
                icon.classList.add('fa-microphone-slash');
                // ÛŒÛØ§Úº WebRTC logic Ø¢Ø¦Û’ Ú¯ÛŒ Ù…Ø§Ø¦ÛŒÚ© Ø¨Ù†Ø¯ Ú©Ø±Ù†Û’ Ú©ÛŒ
                console.log("Mic Muted");
            }
        }

        // Ù„Ù†Ú© Ú©Ø§Ù¾ÛŒ Ú©Ø±Ù†Û’ Ú©Ø§ ÙÙ†Ú©Ø´Ù†
        function copyLink() {
            navigator.clipboard.writeText(window.location.href);
            alert("Link copied to clipboard! Share it with friends.");
        }

    </script>
</body>
</html>
